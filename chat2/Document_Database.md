# 第二章 - Document DataBase Vs RDBMS

## 文件資料庫(Document DataBase)
是NoSQL的一種，通常格式是JSON,BSON..等

## 是否重蹈覆徹?
在多對多的關係和連線已常規用在關係資料庫時，文件資料庫和 NoSQL 重啟了辯論：如何以最佳方式在資料庫中表示多對多關係。

文件資料庫能良好處理一對多的關係，但是很難應對多對多的關係，先後出現了不同的解決方案來解決層次模型的侷限性。

其中最突出的 
- 關係模型（relational model，它變成了 SQL，並統治了世界）
- 網狀模型（network model，最初很受關注，但最終變得冷門）

# 網狀模型

網狀模型由一個稱為資料系統語言會議（CODASYL）的委員會進行了標準化，並被數個不同的資料庫廠商實現；也被稱為 CODASYL。

CODASYL 模型是層次模型的推廣。在層次模型的樹結構中，每條記錄只有一個父節點；在網路模式中，每條記錄可能有多個父節點。

EX: “Greater Seattle Area” 地區是一筆Record，每個居住在該地區的使用者都可以與之相關聯。
這允許對多對一和多對多的關係進行建模。

網狀模型中記錄之間的連結不是外來鍵，而更像程式語言中的指標（同時仍然儲存在磁碟上）。訪問記錄的唯一方法是跟隨從根記錄起沿這些鏈路所形成的路徑。這被稱為 訪問路徑（access path）。

CODASYL 中的查詢是透過利用遍歷記錄列和跟隨訪問路徑表在資料庫中移動遊標來執行的。如果記錄有多個父結點（即多個來自其他記錄的傳入指標），則應用程式程式碼必須跟蹤所有的各種關係。

儘管手動選擇訪問路徑能夠最有效地利用當時非常有限的硬體功能，但使得查詢和更新資料庫的程式碼變得複雜不靈活。

無論是分層還是網狀模型，如果你沒有所需資料的路徑，就會陷入困境。

更改應用程式的資料模型是很難的。

# 關係模型

一個 關係（表） 只是一個 元組（行） 的集合，僅此而已。如果想讀取資料，可以選中符合任意條件的行，讀取表中的任何或所有行。你可以透過指定某些列作為匹配關鍵字來讀取特定行。你可以在任何表中插入一個新的行，而不必擔心與其他表的外來鍵關係。

在RDBMS中，查詢最佳化器自動決定查詢的哪些部分以哪個順序執行，以及使用哪些Index。

這些選擇實際上是 “訪問路徑”，但最大的區別在於它們是由查詢最佳化器自動生成的，而不是由程式設計師生成，所以我們很少需要考慮它們。

如果想按新的方式查詢資料，你可以新增一個新的Index，查詢會自動使用最合適的那些索引。關係模型因此使新增應用程式新功能變得更加容易。

關係資料庫的查詢最佳化器是複雜的，已耗費了多年的研究和開發精力。關係模型的一個關鍵洞察是：只需構建一次查詢最佳化器，隨後使用該資料庫的所有應用程式都可以從中受益。如果你沒有查詢最佳化器的話，那麼為特定查詢手動編寫訪問路徑比編寫通用最佳化器更容易。


## 關係型資料庫與文件資料庫在今日的對比

將關係資料庫與文件資料庫進行比較時，可以考慮許多方面的差異，

資料模型：

- 文件資料庫：資料存儲為文件，通常是 JSON、BSON 或其他類似格式的文件。這些文件可以包含許多不同的屬性和結構。
- 關聯式資料庫：資料存儲在預先定義的表格中，這些表格由行和列組成。每一列具有特定的資料類型。

結構靈活性：

- 文件資料庫：高度靈活，允許動態地新增或更改屬性，不需要事先定義結構。
- 關聯式資料庫：結構通常是固定的，當需要更改結構時，可能需要進行資料庫遷移。

查詢能力：
- 文件資料庫：提供針對文件內容的豐富查詢語言，但可能不支援複雜的連接操作。
關聯式資料庫：通過 SQL 語言提供強大的查詢能力，包括多表連接、子查詢等。
交易性質：
- 文件資料庫：可能只提供有限的交易功能。
- 關聯式資料庫：通常提供完全的 ACID（Atomicity, Consistency, Isolation, Durability）特性。

正規化與資料重複性：

- 文件資料庫：可能存在資料重複，尤其是在嵌套的文件中。
- 關聯式資料庫：通常透過資料正規化來減少資料重複性。

擴展性：

- 文件資料庫：設計上經常考慮水平擴展性，方便添加更多的節點來處理增加的負載。
- 關聯式資料庫：雖然也有支援水平擴展的關聯式資料庫，但傳統的關聯式資料庫更傾向於垂直擴展。

生態系統和工具：

- 文件資料庫：儘管已經有很多成熟的工具，但相對於關聯式資料庫，生態系統可能仍較為有限。
- 關聯式資料庫：有著廣泛的工具、應用程式和資源，已經存在了幾十年，具有豐富的社群支援。
這些是兩者之間的主要區別。實際上，選擇哪一種資料庫取決於特定的應用需求、預期的使用情境和開發团队的經驗。

## 文件和關係資料庫的融合
2000年後大多數RDBMS(除MySQL)都以支援XML。這包括對 XML 文件進行本地修改的功能，以及在 XML 文件中進行索引和查詢的功能。這允許應用程式使用那種與文件資料庫應當使用的非常類似的資料模型。

從 9.3 版本的 PostgreSQL，從 5.7 版本的 MySQL 以及從版本 10.5 的 IBM DB2 也對 JSON 文件提供了類似的支援級別。

鑑於用在 Web APIs 的 JSON 流行趨勢，其他關係資料庫很可能會跟隨他們的腳步並新增 JSON 支援。

在文件資料庫中，RethinkDB 在其查詢語言中支援類似關係的連線，一些 MongoDB 驅動程式可以自動解析資料庫引用（有效地執行客戶端連線，可能比在資料庫中執行的連線慢，需要額外的網路往返，並且最佳化更少）。

隨著時間的推移，關係資料庫和文件資料庫似乎變得越來越相似，這是一件好事：資料模型相互補充 ，如果一個數據庫能夠處理類似文件的資料，並能夠對其執行關係查詢，那麼應用程式就可以使用最符合其需求的功能組合。

關係模型和文件模型的混合是未來資料庫一條很好的路線。

